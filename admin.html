<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯®ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - ç®¡ç†è€…ç”»é¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        * { 
            font-family: 'Noto Sans JP', sans-serif;
            scroll-behavior: smooth;
        }
        
        body {
            background: linear-gradient(135deg, #0f0c29 0%, #24243e 50%, #313862 100%);
            min-height: 100vh;
        }
        
        .admin-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            background-size: 400% 400%;
            animation: gradientShift 20s ease infinite;
            position: relative;
            overflow: hidden;
        }
        
        .admin-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(1px);
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .dark-glass-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .region-tab {
            padding: 16px 24px;
            border-radius: 16px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }
        
        .region-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }
        
        .region-tab:hover::before {
            left: 100%;
        }
        
        .region-tab:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }
        
        .region-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: #667eea;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
            transform: translateY(-2px);
        }
        
        .metric-card {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--accent-color);
        }
        
        .metric-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
        
        .metric-card.total { --accent-color: linear-gradient(135deg, #667eea, #764ba2); }
        .metric-card.occupancy { --accent-color: linear-gradient(135deg, #3b82f6, #2563eb); }
        .metric-card.revenue { --accent-color: linear-gradient(135deg, #10b981, #059669); }
        .metric-card.attention { --accent-color: linear-gradient(135deg, #ef4444, #dc2626); }
        
        .region-overview {
            background: white;
            border-radius: 20px;
            padding: 1.5rem;
            border-left: 6px solid;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .region-overview::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 4px;
            height: 100%;
            background: var(--region-color);
            opacity: 0.3;
        }
        
        .region-overview:hover {
            transform: translateX(4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }
        
        .region-tokyo { 
            border-left-color: #3b82f6; 
            --region-color: #3b82f6;
        }
        .region-yokohama { 
            border-left-color: #06b6d4; 
            --region-color: #06b6d4;
        }
        .region-nagoya { 
            border-left-color: #10b981; 
            --region-color: #10b981;
        }
        .region-yokkaichi { 
            border-left-color: #8b5cf6; 
            --region-color: #8b5cf6;
        }
        .region-fukuoka { 
            border-left-color: #f59e0b; 
            --region-color: #f59e0b;
        }
        
        .nav-button {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .nav-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        .nav-button.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: #667eea;
        }
        
        .spreadsheet-container {
            background: white;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .spreadsheet-toolbar {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
        }
        
        .spreadsheet-cell {
            padding: 16px;
            border-right: 1px solid #e5e7eb;
            border-bottom: 1px solid #e5e7eb;
            transition: all 0.2s ease;
            min-width: 150px;
        }
        
        .spreadsheet-cell:hover {
            background-color: #fafbfc;
        }
        
        .spreadsheet-cell input, 
        .spreadsheet-cell select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }
        
        .spreadsheet-cell input:focus, 
        .spreadsheet-cell select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            transform: scale(1.02);
        }
        
        .spreadsheet-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 700;
            position: sticky;
            top: 0;
            z-index: 10;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }
        
        .btn-primary:hover::before {
            left: 100%;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: white;
            color: #374151;
            border: 2px solid #e5e7eb;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .btn-secondary:hover {
            border-color: #667eea;
            background: #f8fafc;
            transform: translateY(-2px);
        }
        
        .floating-actions {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .floating-btn {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
        }
        
        .floating-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 32px rgba(102, 126, 234, 0.6);
        }
        
        .notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: white;
            border-radius: 16px;
            padding: 1rem 1.5rem;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            border-left: 6px solid;
            z-index: 1000;
            animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 400px;
        }
        
        .notification.success { border-left-color: #10b981; }
        .notification.error { border-left-color: #ef4444; }
        .notification.warning { border-left-color: #f59e0b; }
        .notification.info { border-left-color: #3b82f6; }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: white;
            border-radius: 24px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: scaleIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .table-container {
            max-height: 70vh;
            overflow: auto;
        }
        
        .sticky-column {
            position: sticky;
            left: 0;
            background: white;
            z-index: 5;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.05);
        }
        
        .chart-container {
            position: relative;
            height: 320px;
            margin: 1rem 0;
        }
        
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        @media (max-width: 768px) {
            .overview-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .floating-actions {
                bottom: 1rem;
                right: 1rem;
            }
            
            .floating-btn {
                width: 56px;
                height: 56px;
                font-size: 18px;
            }
            
            .spreadsheet-toolbar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .region-tab {
                padding: 12px 16px;
                margin: 4px;
            }
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 6px solid #f3f4f6;
            border-top: 6px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .activity-item {
            background: white;
            border-radius: 16px;
            padding: 1rem;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
            margin-bottom: 0.5rem;
        }
        
        .activity-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-indicator.vacant { background: #10b981; }
        .status-indicator.occupied { background: #3b82f6; }
        .status-indicator.cleaning { background: #f59e0b; }
        .status-indicator.maintenance { background: #ef4444; }
    </style>
</head>

<body class="min-h-screen">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="admin-header text-white shadow-2xl relative">
        <div class="container mx-auto px-6 py-8 relative z-10">
            <div class="flex flex-col lg:flex-row justify-between items-center">
                <div class="text-center lg:text-left mb-6 lg:mb-0">
                    <h1 class="text-4xl font-black mb-3 drop-shadow-lg">
                        ğŸ‘‘ å¯®ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - ç®¡ç†è€…ç”»é¢
                    </h1>
                    <p class="text-xl text-white/90 drop-shadow">å…¨åœ°åŸŸçµ±åˆç®¡ç† | å·æº€ã•ã‚“å°‚ç”¨ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</p>
                </div>
                
                <div class="flex flex-wrap items-center gap-3">
                    <button onclick="showSection('overview')" class="nav-button">
                        <i class="fas fa-chart-pie mr-2"></i>æ¦‚è¦
                    </button>
                    <button onclick="showSection('spreadsheet')" class="nav-button">
                        <i class="fas fa-table mr-2"></i>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ
                    </button>
                    <button onclick="showSection('analytics')" class="nav-button">
                        <i class="fas fa-chart-bar mr-2"></i>åˆ†æ
                    </button>
                    <button onclick="showSection('logs')" class="nav-button">
                        <i class="fas fa-history mr-2"></i>ãƒ­ã‚°
                    </button>
                    <a href="index.html" class="btn-primary inline-flex items-center">
                        <i class="fas fa-arrow-left mr-2"></i>ã‚¹ã‚¿ãƒƒãƒ•ç”»é¢
                    </a>
                </div>
            </div>
            
            <!-- åœ°åŸŸã‚¿ãƒ– -->
            <div class="flex flex-wrap gap-3 mt-8" id="regionTabs">
                <div class="region-tab active" onclick="selectRegion('all')">
                    <i class="fas fa-globe mr-2"></i>å…¨åœ°åŸŸ
                </div>
                <div class="region-tab" onclick="selectRegion('tokyo')">
                    ğŸ—¼ æ±äº¬
                </div>
                <div class="region-tab" onclick="selectRegion('yokohama')">
                    âš“ æ¨ªæµœ
                </div>
                <div class="region-tab" onclick="selectRegion('nagoya')">
                    ğŸ­ åå¤å±‹
                </div>
                <div class="region-tab" onclick="selectRegion('yokkaichi')">
                    ğŸ­ å››æ—¥å¸‚
                </div>
                <div class="region-tab" onclick="selectRegion('fukuoka')">
                    ğŸŒ¸ ç¦å²¡
                </div>
            </div>
        </div>
    </header>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div class="container mx-auto px-6 py-8">
        <!-- æ¦‚è¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div id="overview" class="section">
            <!-- å…¨ä½“çµ±è¨ˆ -->
            <div class="stats-grid">
                <div class="metric-card total">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-semibold text-gray-600 uppercase tracking-wide">ç·å®¤æ•°</p>
                            <p class="text-4xl font-black text-gray-900 mt-2" id="totalRooms">0</p>
                            <p class="text-sm text-gray-500 mt-1">å…¨åœ°åŸŸåˆè¨ˆ</p>
                        </div>
                        <div class="text-purple-600 text-5xl">
                            ğŸ¢
                        </div>
                    </div>
                </div>
                
                <div class="metric-card occupancy">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-semibold text-gray-600 uppercase tracking-wide">ç¨¼åƒç‡</p>
                            <p class="text-4xl font-black text-blue-600 mt-2" id="occupancyRate">0%</p>
                            <p class="text-sm text-gray-500 mt-1">å…¥å®¤ä¸­ã®å‰²åˆ</p>
                        </div>
                        <div class="text-blue-600 text-5xl">
                            ğŸ“ˆ
                        </div>
                    </div>
                </div>
                
                <div class="metric-card revenue">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-semibold text-gray-600 uppercase tracking-wide">æœˆæ¬¡å£²ä¸Šäºˆæƒ³</p>
                            <p class="text-4xl font-black text-green-600 mt-2" id="monthlyRevenue">Â¥0</p>
                            <p class="text-sm text-gray-500 mt-1">å…¥å®¤ä¸­ã‹ã‚‰è¨ˆç®—</p>
                        </div>
                        <div class="text-green-600 text-5xl">
                            ğŸ’°
                        </div>
                    </div>
                </div>
                
                <div class="metric-card attention">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-semibold text-gray-600 uppercase tracking-wide">è¦å¯¾å¿œ</p>
                            <p class="text-4xl font-black text-red-600 mt-2" id="attentionNeeded">0</p>
                            <p class="text-sm text-gray-500 mt-1">æ¸…æƒãƒ»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹</p>
                        </div>
                        <div class="text-red-600 text-5xl">
                            âš ï¸
                        </div>
                    </div>
                </div>
            </div>

            <!-- åœ°åŸŸåˆ¥æ¦‚è¦ -->
            <div class="glass-card p-8 mb-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-map-marked-alt mr-3 text-purple-600"></i>åœ°åŸŸåˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
                </h3>
                <div class="overview-grid" id="regionOverviews">
                    <!-- å‹•çš„ã«ç”Ÿæˆ -->
                </div>
            </div>

            <!-- ä»Šæ—¥ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ -->
            <div class="glass-card p-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-clock mr-3 text-blue-600"></i>ä»Šæ—¥ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£
                </h3>
                <div id="todayActivities" class="space-y-3">
                    <!-- å‹•çš„ã«ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <!-- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div id="spreadsheet" class="section hidden">
            <div class="spreadsheet-container">
                <!-- ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ -->
                <div class="spreadsheet-toolbar">
                    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
                        <div class="flex items-center gap-4">
                            <h3 class="text-xl font-bold text-gray-800">
                                <i class="fas fa-table mr-2 text-purple-600"></i>ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ
                            </h3>
                            <select id="regionFilter" onchange="filterSpreadsheet()" class="px-4 py-2 border-2 border-gray-200 rounded-lg text-sm font-medium focus:border-purple-500 focus:ring-2 focus:ring-purple-200">
                                <option value="all">å…¨åœ°åŸŸ</option>
                                <option value="tokyo">ğŸ—¼ æ±äº¬</option>
                                <option value="yokohama">âš“ æ¨ªæµœ</option>
                                <option value="nagoya">ğŸ­ åå¤å±‹</option>
                                <option value="yokkaichi">ğŸ­ å››æ—¥å¸‚</option>
                                <option value="fukuoka">ğŸŒ¸ ç¦å²¡</option>
                            </select>
                        </div>
                        
                        <div class="flex flex-wrap gap-3">
                            <button onclick="validateAllData()" class="btn-secondary inline-flex items-center">
                                <i class="fas fa-check-circle mr-2"></i>ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼
                            </button>
                            <button onclick="bulkEditMode()" class="btn-secondary inline-flex items-center">
                                <i class="fas fa-edit mr-2"></i>ä¸€æ‹¬ç·¨é›†
                            </button>
                            <button onclick="exportToExcel('current')" class="btn-primary inline-flex items-center">
                                <i class="fas fa-file-excel mr-2"></i>Excelå‡ºåŠ›
                            </button>
                            <button onclick="saveAllChanges()" class="btn-primary inline-flex items-center">
                                <i class="fas fa-save mr-2"></i>ä¿å­˜
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ -->
                <div class="table-container">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="spreadsheet-header">
                                <th class="sticky-column spreadsheet-cell">åœ°åŸŸ</th>
                                <th class="sticky-column spreadsheet-cell">å¯®ç•ªå·</th>
                                <th class="spreadsheet-cell">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                                <th class="spreadsheet-cell">æœ€çµ‚æ›´æ–°</th>
                                <th class="spreadsheet-cell">æ‹…å½“è€…</th>
                                <th class="spreadsheet-cell">å‚™è€ƒ</th>
                                <th class="spreadsheet-cell">å…¥å®¤æ—¥</th>
                                <th class="spreadsheet-cell">äºˆå®šé€€å®¤æ—¥</th>
                                <th class="spreadsheet-cell">æœˆé¡æ–™é‡‘</th>
                                <th class="spreadsheet-cell">æ”¯æ‰•çŠ¶æ³</th>
                                <th class="spreadsheet-cell">æ¸…æƒçŠ¶æ³</th>
                                <th class="spreadsheet-cell">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="spreadsheetBody">
                            <!-- å‹•çš„ã«ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- åˆ†æã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div id="analytics" class="section hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- åœ°åŸŸåˆ¥ç¨¼åƒç‡ -->
                <div class="glass-card p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-chart-pie mr-2 text-purple-600"></i>åœ°åŸŸåˆ¥ç¨¼åƒç‡
                    </h3>
                    <div class="chart-container">
                        <canvas id="occupancyChart"></canvas>
                    </div>
                </div>

                <!-- æœˆæ¬¡æ¨ç§» -->
                <div class="glass-card p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-chart-line mr-2 text-blue-600"></i>ç¨¼åƒç‡æ¨ç§»
                    </h3>
                    <div class="chart-container">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>

                <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ†å¸ƒ -->
                <div class="glass-card p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-chart-bar mr-2 text-green-600"></i>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ†å¸ƒ
                    </h3>
                    <div class="chart-container">
                        <canvas id="statusChart"></canvas>
                    </div>
                </div>

                <!-- å£²ä¸Šåˆ†æ -->
                <div class="glass-card p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-money-bill-wave mr-2 text-yellow-600"></i>åœ°åŸŸåˆ¥å£²ä¸Šåˆ†æ
                    </h3>
                    <div class="chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- ãƒ­ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div id="logs" class="section hidden">
            <div class="glass-card">
                <!-- ãƒ­ã‚°ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ -->
                <div class="spreadsheet-toolbar">
                    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
                        <h3 class="text-xl font-bold text-gray-800">
                            <i class="fas fa-history mr-2 text-green-600"></i>æ´»å‹•ãƒ­ã‚°å±¥æ­´
                        </h3>
                        <div class="flex items-center gap-3">
                            <select id="logRegionFilter" onchange="filterLogs()" class="px-4 py-2 border-2 border-gray-200 rounded-lg text-sm font-medium">
                                <option value="all">å…¨åœ°åŸŸ</option>
                                <option value="tokyo">ğŸ—¼ æ±äº¬</option>
                                <option value="yokohama">âš“ æ¨ªæµœ</option>
                                <option value="nagoya">ğŸ­ åå¤å±‹</option>
                                <option value="yokkaichi">ğŸ­ å››æ—¥å¸‚</option>
                                <option value="fukuoka">ğŸŒ¸ ç¦å²¡</option>
                            </select>
                            <select id="logPeriodFilter" onchange="filterLogs()" class="px-4 py-2 border-2 border-gray-200 rounded-lg text-sm font-medium">
                                <option value="all">å…¨æœŸé–“</option>
                                <option value="today">ä»Šæ—¥</option>
                                <option value="week">ä»Šé€±</option>
                                <option value="month">ä»Šæœˆ</option>
                            </select>
                            <button onclick="exportToExcel('logs')" class="btn-primary inline-flex items-center">
                                <i class="fas fa-file-excel mr-2"></i>ãƒ­ã‚°å‡ºåŠ›
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ãƒ­ã‚°ãƒ†ãƒ¼ãƒ–ãƒ« -->
                <div class="table-container">
                    <table class="w-full text-sm">
                        <thead class="spreadsheet-header">
                            <tr>
                                <th class="spreadsheet-cell">æ—¥æ™‚</th>
                                <th class="spreadsheet-cell">åœ°åŸŸ</th>
                                <th class="spreadsheet-cell">å¯®ç•ªå·</th>
                                <th class="spreadsheet-cell">æ“ä½œ</th>
                                <th class="spreadsheet-cell">æ‹…å½“è€…</th>
                                <th class="spreadsheet-cell">å‚™è€ƒ</th>
                            </tr>
                        </thead>
                        <tbody id="logsTableBody">
                            <!-- å‹•çš„ã«ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸€æ‹¬ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="bulkEditModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 class="text-2xl font-bold mb-6 text-gray-800">
                <i class="fas fa-edit mr-3 text-purple-600"></i>ä¸€æ‹¬ç·¨é›†
            </h3>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-3">å¯¾è±¡åœ°åŸŸ</label>
                    <select id="bulkRegion" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200">
                        <option value="">åœ°åŸŸã‚’é¸æŠ</option>
                        <option value="tokyo">ğŸ—¼ æ±äº¬</option>
                        <option value="yokohama">âš“ æ¨ªæµœ</option>
                        <option value="nagoya">ğŸ­ åå¤å±‹</option>
                        <option value="yokkaichi">ğŸ­ å››æ—¥å¸‚</option>
                        <option value="fukuoka">ğŸŒ¸ ç¦å²¡</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-3">å¯¾è±¡å¯®</label>
                    <div class="grid grid-cols-4 gap-3 max-h-40 overflow-y-auto border-2 border-gray-200 rounded-lg p-4" id="bulkSelectDorms">
                        <!-- å‹•çš„ã«ç”Ÿæˆ -->
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-3">å¤‰æ›´ã™ã‚‹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
                    <select id="bulkStatus" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="vacant">ğŸšª ç©ºå®¤</option>
                        <option value="occupied">ğŸ  å…¥å®¤ä¸­</option>
                        <option value="cleaning">ğŸ§¹ æ¸…æƒä¸­</option>
                        <option value="maintenance">ğŸ”§ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-3">æ‹…å½“è€…</label>
                    <input type="text" id="bulkStaff" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200" placeholder="æ‹…å½“è€…å">
                </div>
                
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-3">å‚™è€ƒ</label>
                    <textarea id="bulkNotes" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200" rows="3" placeholder="ä¸€æ‹¬å¤‰æ›´ã®ç†ç”±ã‚„å‚™è€ƒ"></textarea>
                </div>
            </div>
            
            <div class="flex justify-end gap-4 mt-8">
                <button onclick="closeBulkEditModal()" class="btn-secondary">
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
                <button onclick="executeBulkEdit()" class="btn-primary">
                    ä¸€æ‹¬å¤‰æ›´å®Ÿè¡Œ
                </button>
            </div>
        </div>
    </div>

    <!-- ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="floating-actions">
        <button class="floating-btn" onclick="quickExport()" title="ã‚¯ã‚¤ãƒƒã‚¯å‡ºåŠ›">
            <i class="fas fa-download"></i>
        </button>
        <button class="floating-btn" onclick="showSection('overview')" title="æ¦‚è¦ã«æˆ»ã‚‹">
            <i class="fas fa-home"></i>
        </button>
    </div>

    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="text-center">
            <div class="loading-spinner"></div>
            <p class="mt-4 text-gray-600 font-semibold text-lg">ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ä¸­...</p>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let currentRegionFilter = 'all';
        let allDormitories = {};
        let allLogs = [];
        let charts = {};

        // åœ°åŸŸãƒ‡ãƒ¼ã‚¿ï¼ˆ5åœ°åŸŸã«ä¿®æ­£ï¼‰
        const regions = {
            tokyo: { name: 'æ±äº¬ã‚¨ãƒªã‚¢', icon: 'ğŸ—¼', rooms: 20, price: 68000, color: '#3b82f6' },
            yokohama: { name: 'æ¨ªæµœã‚¨ãƒªã‚¢', icon: 'âš“', rooms: 18, price: 62000, color: '#06b6d4' },
            nagoya: { name: 'åå¤å±‹ã‚¨ãƒªã‚¢', icon: 'ğŸ­', rooms: 16, price: 55000, color: '#10b981' },
            yokkaichi: { name: 'å››æ—¥å¸‚ã‚¨ãƒªã‚¢', icon: 'ğŸ­', rooms: 14, price: 48000, color: '#8b5cf6' },
            fukuoka: { name: 'ç¦å²¡ã‚¨ãƒªã‚¢', icon: 'ğŸŒ¸', rooms: 15, price: 52000, color: '#f59e0b' }
        };

        // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        function loadAllData() {
            showLoading();
            allDormitories = {};
            allLogs = [];

            Object.keys(regions).forEach(regionId => {
                const storageKey = `dormitories_${regionId}`;
                const logsKey = `activityLogs_${regionId}`;
                
                const savedDormitories = localStorage.getItem(storageKey);
                const savedLogs = localStorage.getItem(logsKey);
                
                if (savedDormitories) {
                    const regionDorms = JSON.parse(savedDormitories);
                    Object.keys(regionDorms).forEach(key => {
                        const dorm = regionDorms[key];
                        dorm.region = regionId;
                        dorm.price = regions[regionId].price;
                        if (!dorm.paymentStatus) dorm.paymentStatus = 'paid';
                        if (!dorm.cleaningStatus) dorm.cleaningStatus = 'clean';
                        if (!dorm.checkinDate) dorm.checkinDate = '';
                        if (!dorm.expectedCheckout) dorm.expectedCheckout = '';
                        
                        allDormitories[`${regionId}_${key}`] = dorm;
                    });
                } else {
                    initializeRegionData(regionId);
                }
                
                if (savedLogs) {
                    const regionLogs = JSON.parse(savedLogs);
                    regionLogs.forEach(log => {
                        log.region = regionId;
                        allLogs.push(log);
                    });
                }
            });
            
            allLogs.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            hideLoading();
        }

        function initializeRegionData(regionId) {
            const roomCount = regions[regionId].rooms;
            
            for (let i = 1; i <= roomCount; i++) {
                const dorm = {
                    number: i,
                    region: regionId,
                    status: getRandomStatus(),
                    lastUpdated: new Date().toISOString(),
                    staff: '',
                    notes: '',
                    price: regions[regionId].price,
                    paymentStatus: Math.random() > 0.1 ? 'paid' : 'pending',
                    cleaningStatus: Math.random() > 0.2 ? 'clean' : 'dirty',
                    checkinDate: '',
                    expectedCheckout: ''
                };
                
                if (dorm.status === 'occupied') {
                    dorm.checkinDate = new Date(Date.now() - Math.random() * 60 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                    dorm.expectedCheckout = new Date(Date.now() + Math.random() * 90 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                }
                
                allDormitories[`${regionId}_${i}`] = dorm;
            }
            
            saveRegionData(regionId);
        }

        function getRandomStatus() {
            const statuses = ['vacant', 'occupied', 'cleaning', 'maintenance'];
            const weights = [0.3, 0.5, 0.15, 0.05];
            
            const random = Math.random();
            let cumulative = 0;
            
            for (let i = 0; i < statuses.length; i++) {
                cumulative += weights[i];
                if (random < cumulative) {
                    return statuses[i];
                }
            }
            return 'vacant';
        }

        function saveRegionData(regionId) {
            const regionDorms = {};
            const regionLogs = [];
            
            Object.keys(allDormitories).forEach(key => {
                const dorm = allDormitories[key];
                if (dorm.region === regionId) {
                    regionDorms[dorm.number] = dorm;
                }
            });
            
            allLogs.forEach(log => {
                if (log.region === regionId) {
                    regionLogs.push(log);
                }
            });
            
            localStorage.setItem(`dormitories_${regionId}`, JSON.stringify(regionDorms));
            localStorage.setItem(`activityLogs_${regionId}`, JSON.stringify(regionLogs));
        }

        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
        function showLoading() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        // ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆ
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');

            // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event?.target.classList.add('active');

            if (sectionId === 'overview') {
                updateOverview();
            } else if (sectionId === 'spreadsheet') {
                renderSpreadsheet();
            } else if (sectionId === 'analytics') {
                renderCharts();
            } else if (sectionId === 'logs') {
                renderLogs();
            }
        }

        // åœ°åŸŸãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
        function selectRegion(regionId) {
            currentRegionFilter = regionId;
            
            document.querySelectorAll('.region-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            const currentSection = document.querySelector('.section:not(.hidden)').id;
            showSection(currentSection);
        }

        // æ¦‚è¦æ›´æ–°
        function updateOverview() {
            const filteredDorms = getFilteredDormitories();
            const stats = calculateStatistics(filteredDorms);
            
            document.getElementById('totalRooms').textContent = filteredDorms.length;
            document.getElementById('occupancyRate').textContent = `${Math.round((stats.occupied / filteredDorms.length) * 100)}%`;
            document.getElementById('monthlyRevenue').textContent = `Â¥${(stats.occupied * getAveragePrice()).toLocaleString()}`;
            document.getElementById('attentionNeeded').textContent = stats.cleaning + stats.maintenance;
            
            renderRegionOverviews();
            renderTodayActivities();
        }

        function getFilteredDormitories() {
            if (currentRegionFilter === 'all') {
                return Object.values(allDormitories);
            }
            return Object.values(allDormitories).filter(dorm => dorm.region === currentRegionFilter);
        }

        function calculateStatistics(dormitories) {
            const stats = { vacant: 0, occupied: 0, cleaning: 0, maintenance: 0 };
            dormitories.forEach(dorm => {
                stats[dorm.status]++;
            });
            return stats;
        }

        function getAveragePrice() {
            const prices = Object.values(regions).map(r => r.price);
            return prices.reduce((sum, price) => sum + price, 0) / prices.length;
        }

        function renderRegionOverviews() {
            const container = document.getElementById('regionOverviews');
            container.innerHTML = '';

            Object.keys(regions).forEach(regionId => {
                const regionDorms = Object.values(allDormitories).filter(dorm => dorm.region === regionId);
                const stats = calculateStatistics(regionDorms);
                const occupancyRate = regionDorms.length > 0 ? Math.round((stats.occupied / regionDorms.length) * 100) : 0;
                
                const card = document.createElement('div');
                card.className = `region-overview region-${regionId}`;
                card.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h4 class="font-bold text-xl text-gray-800">${regions[regionId].icon} ${regions[regionId].name}</h4>
                            <p class="text-sm text-gray-600 mt-1">${regionDorms.length}å®¤ | ç¨¼åƒç‡ ${occupancyRate}%</p>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-black text-green-600">Â¥${(stats.occupied * regions[regionId].price).toLocaleString()}</div>
                            <div class="text-xs text-gray-500">æœˆæ¬¡å£²ä¸Šäºˆæƒ³</div>
                        </div>
                    </div>
                    <div class="grid grid-cols-4 gap-3 text-center text-sm">
                        <div class="bg-green-50 p-3 rounded-lg border border-green-200">
                            <div class="font-bold text-green-700 text-lg">${stats.vacant}</div>
                            <div class="text-xs text-gray-600">ç©ºå®¤</div>
                        </div>
                        <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                            <div class="font-bold text-blue-700 text-lg">${stats.occupied}</div>
                            <div class="text-xs text-gray-600">å…¥å®¤</div>
                        </div>
                        <div class="bg-yellow-50 p-3 rounded-lg border border-yellow-200">
                            <div class="font-bold text-yellow-700 text-lg">${stats.cleaning}</div>
                            <div class="text-xs text-gray-600">æ¸…æƒ</div>
                        </div>
                        <div class="bg-red-50 p-3 rounded-lg border border-red-200">
                            <div class="font-bold text-red-700 text-lg">${stats.maintenance}</div>
                            <div class="text-xs text-gray-600">ãƒ¡ãƒ³ãƒ†</div>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function renderTodayActivities() {
            const today = new Date().toDateString();
            const todayLogs = allLogs.filter(log => 
                new Date(log.timestamp).toDateString() === today &&
                (currentRegionFilter === 'all' || log.region === currentRegionFilter)
            );
            
            const container = document.getElementById('todayActivities');
            if (todayLogs.length === 0) {
                container.innerHTML = '<div class="text-center py-12 text-gray-500"><i class="fas fa-calendar-check text-4xl mb-4"></i><p class="text-lg">ä»Šæ—¥ã¯ã¾ã æ´»å‹•ãŒã‚ã‚Šã¾ã›ã‚“</p></div>';
                return;
            }
            
            container.innerHTML = todayLogs.slice(0, 10).map(log => `
                <div class="activity-item">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="text-3xl">${regions[log.region].icon}</div>
                            <div>
                                <div class="font-semibold text-gray-800">å¯®${log.dormNumber} (${regions[log.region].name})</div>
                                <div class="text-sm text-gray-600">${getActionText(log.action)} by ${log.staff}</div>
                                ${log.notes ? `<div class="text-xs text-gray-500 mt-1">${log.notes}</div>` : ''}
                            </div>
                        </div>
                        <div class="text-sm text-gray-500 font-mono">
                            ${new Date(log.timestamp).toLocaleTimeString('ja-JP', {hour: '2-digit', minute: '2-digit'})}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæç”»
        function renderSpreadsheet() {
            const tbody = document.getElementById('spreadsheetBody');
            tbody.innerHTML = '';
            
            const filteredDorms = getFilteredDormitories();
            
            filteredDorms.forEach(dorm => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors';
                row.innerHTML = `
                    <td class="sticky-column spreadsheet-cell font-semibold">
                        <div class="flex items-center">
                            <span class="text-lg mr-2">${regions[dorm.region].icon}</span>
                            <span>${regions[dorm.region].name}</span>
                        </div>
                    </td>
                    <td class="sticky-column spreadsheet-cell font-bold text-purple-700">å¯®${dorm.number}</td>
                    <td class="spreadsheet-cell">
                        <select onchange="updateDormField('${dorm.region}_${dorm.number}', 'status', this.value)">
                            <option value="vacant" ${dorm.status === 'vacant' ? 'selected' : ''}>ğŸšª ç©ºå®¤</option>
                            <option value="occupied" ${dorm.status === 'occupied' ? 'selected' : ''}>ğŸ  å…¥å®¤ä¸­</option>
                            <option value="cleaning" ${dorm.status === 'cleaning' ? 'selected' : ''}>ğŸ§¹ æ¸…æƒä¸­</option>
                            <option value="maintenance" ${dorm.status === 'maintenance' ? 'selected' : ''}>ğŸ”§ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹</option>
                        </select>
                    </td>
                    <td class="spreadsheet-cell text-gray-600 font-mono text-xs">
                        ${new Date(dorm.lastUpdated).toLocaleString('ja-JP')}
                    </td>
                    <td class="spreadsheet-cell">
                        <input type="text" value="${dorm.staff || ''}" 
                               onchange="updateDormField('${dorm.region}_${dorm.number}', 'staff', this.value)"
                               placeholder="æ‹…å½“è€…å">
                    </td>
                    <td class="spreadsheet-cell">
                        <input type="text" value="${dorm.notes || ''}" 
                               onchange="updateDormField('${dorm.region}_${dorm.number}', 'notes', this.value)"
                               placeholder="å‚™è€ƒ">
                    </td>
                    <td class="spreadsheet-cell">
                        <input type="date" value="${dorm.checkinDate || ''}" 
                               onchange="updateDormField('${dorm.region}_${dorm.number}', 'checkinDate', this.value)">
                    </td>
                    <td class="spreadsheet-cell">
                        <input type="date" value="${dorm.expectedCheckout || ''}" 
                               onchange="updateDormField('${dorm.region}_${dorm.number}', 'expectedCheckout', this.value)">
                    </td>
                    <td class="spreadsheet-cell">
                        <input type="number" value="${dorm.price || ''}" 
                               onchange="updateDormField('${dorm.region}_${dorm.number}', 'price', this.value)"
                               class="text-right font-semibold">
                    </td>
                    <td class="spreadsheet-cell">
                        <select onchange="updateDormField('${dorm.region}_${dorm.number}', 'paymentStatus', this.value)">
                            <option value="paid" ${dorm.paymentStatus === 'paid' ? 'selected' : ''}>âœ… æ”¯æ‰•æ¸ˆ</option>
                            <option value="pending" ${dorm.paymentStatus === 'pending' ? 'selected' : ''}>â³ æœªæ‰•ã„</option>
                            <option value="overdue" ${dorm.paymentStatus === 'overdue' ? 'selected' : ''}>âš ï¸ é…å»¶</option>
                        </select>
                    </td>
                    <td class="spreadsheet-cell">
                        <select onchange="updateDormField('${dorm.region}_${dorm.number}', 'cleaningStatus', this.value)">
                            <option value="clean" ${dorm.cleaningStatus === 'clean' ? 'selected' : ''}>âœ¨ æ¸…æ½”</option>
                            <option value="dirty" ${dorm.cleaningStatus === 'dirty' ? 'selected' : ''}>ğŸ§¹ è¦æ¸…æƒ</option>
                            <option value="deep" ${dorm.cleaningStatus === 'deep' ? 'selected' : ''}>ğŸ”§ å¤§æƒé™¤å¿…è¦</option>
                        </select>
                    </td>
                    <td class="spreadsheet-cell text-center">
                        <button onclick="deleteDormData('${dorm.region}_${dorm.number}')" 
                                class="text-red-600 hover:text-red-800 hover:bg-red-50 p-2 rounded-lg transition-all"
                                title="å‰Šé™¤">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ãƒ‡ãƒ¼ã‚¿æ›´æ–°
        function updateDormField(dormKey, field, value) {
            allDormitories[dormKey][field] = value;
            allDormitories[dormKey].lastUpdated = new Date().toISOString();
            
            const [region, dormNumber] = dormKey.split('_');
            
            // ãƒ­ã‚°è¨˜éŒ²
            allLogs.unshift({
                id: allLogs.length + 1,
                dormNumber: parseInt(dormNumber),
                action: 'update',
                field: field,
                newValue: value,
                staff: 'ç®¡ç†è€…',
                timestamp: new Date().toISOString(),
                notes: `${field}ã‚’æ›´æ–°`,
                region: region
            });
            
            saveRegionData(region);
            showNotification('ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'success');
        }

        // ãƒãƒ£ãƒ¼ãƒˆæç”»
        function renderCharts() {
            renderOccupancyChart();
            renderTrendChart();
            renderStatusChart();
            renderRevenueChart();
        }

        function renderOccupancyChart() {
            const ctx = document.getElementById('occupancyChart').getContext('2d');
            
            if (charts.occupancy) {
                charts.occupancy.destroy();
            }
            
            const data = Object.keys(regions).map(regionId => {
                const regionDorms = Object.values(allDormitories).filter(dorm => dorm.region === regionId);
                const occupied = regionDorms.filter(dorm => dorm.status === 'occupied').length;
                return regionDorms.length > 0 ? Math.round((occupied / regionDorms.length) * 100) : 0;
            });
            
            charts.occupancy = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.values(regions).map(r => r.name),
                    datasets: [{
                        data: data,
                        backgroundColor: Object.values(regions).map(r => r.color),
                        borderWidth: 0,
                        hoverOffset: 20
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderTrendChart() {
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            if (charts.trend) {
                charts.trend.destroy();
            }
            
            const months = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'];
            const trendData = months.map(() => Math.floor(Math.random() * 30) + 60);
            
            charts.trend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'ç¨¼åƒç‡ (%)',
                        data: trendData,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 3,
                        pointBackgroundColor: '#667eea',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function renderStatusChart() {
            const ctx = document.getElementById('statusChart').getContext('2d');
            
            if (charts.status) {
                charts.status.destroy();
            }
            
            const allStats = calculateStatistics(Object.values(allDormitories));
            
            charts.status = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['ğŸšª ç©ºå®¤', 'ğŸ  å…¥å®¤ä¸­', 'ğŸ§¹ æ¸…æƒä¸­', 'ğŸ”§ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹'],
                    datasets: [{
                        data: [allStats.vacant, allStats.occupied, allStats.cleaning, allStats.maintenance],
                        backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#ef4444'],
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function renderRevenueChart() {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            
            if (charts.revenue) {
                charts.revenue.destroy();
            }
            
            const revenueData = Object.keys(regions).map(regionId => {
                const regionDorms = Object.values(allDormitories).filter(dorm => dorm.region === regionId);
                const occupied = regionDorms.filter(dorm => dorm.status === 'occupied').length;
                return occupied * regions[regionId].price / 10000; // ä¸‡å††å˜ä½
            });
            
            charts.revenue = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.values(regions).map(r => r.name),
                    datasets: [{
                        label: 'å£²ä¸Šäºˆæƒ³ (ä¸‡å††)',
                        data: revenueData,
                        backgroundColor: Object.values(regions).map(r => r.color),
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // ãƒ­ã‚°è¡¨ç¤º
        function renderLogs() {
            const regionFilter = document.getElementById('logRegionFilter').value;
            const periodFilter = document.getElementById('logPeriodFilter').value;
            
            let filteredLogs = allLogs;
            
            if (regionFilter !== 'all') {
                filteredLogs = filteredLogs.filter(log => log.region === regionFilter);
            }
            
            if (periodFilter !== 'all') {
                const now = new Date();
                const filterDate = new Date();
                
                switch (periodFilter) {
                    case 'today':
                        filterDate.setHours(0, 0, 0, 0);
                        break;
                    case 'week':
                        filterDate.setDate(filterDate.getDate() - 7);
                        break;
                    case 'month':
                        filterDate.setMonth(filterDate.getMonth() - 1);
                        break;
                }
                
                filteredLogs = filteredLogs.filter(log => new Date(log.timestamp) >= filterDate);
            }
            
            const tbody = document.getElementById('logsTableBody');
            tbody.innerHTML = filteredLogs.slice(0, 100).map(log => `
                <tr class="border-b hover:bg-gray-50 transition-colors">
                    <td class="spreadsheet-cell text-sm font-mono">${new Date(log.timestamp).toLocaleString('ja-JP')}</td>
                    <td class="spreadsheet-cell">
                        <div class="flex items-center">
                            <span class="text-lg mr-2">${regions[log.region].icon}</span>
                            <span class="font-medium">${regions[log.region].name}</span>
                        </div>
                    </td>
                    <td class="spreadsheet-cell font-semibold text-purple-700">å¯®${log.dormNumber}</td>
                    <td class="spreadsheet-cell">
                        <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-semibold">
                            ${getActionText(log.action)}
                        </span>
                    </td>
                    <td class="spreadsheet-cell font-medium">${log.staff}</td>
                    <td class="spreadsheet-cell text-gray-600">${log.notes || '-'}</td>
                </tr>
            `).join('');
        }

        // Excelå‡ºåŠ›
        function exportToExcel(type) {
            showLoading();
            
            setTimeout(() => {
                let data, filename;
                
                if (type === 'current') {
                    data = getFilteredDormitories().map(dorm => ({
                        'åœ°åŸŸ': regions[dorm.region].name,
                        'å¯®ç•ªå·': `å¯®${dorm.number}`,
                        'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹': getStatusText(dorm.status),
                        'æœ€çµ‚æ›´æ–°': new Date(dorm.lastUpdated).toLocaleString('ja-JP'),
                        'æ‹…å½“è€…': dorm.staff || '',
                        'å‚™è€ƒ': dorm.notes || '',
                        'å…¥å®¤æ—¥': dorm.checkinDate || '',
                        'äºˆå®šé€€å®¤æ—¥': dorm.expectedCheckout || '',
                        'æœˆé¡æ–™é‡‘': dorm.price || '',
                        'æ”¯æ‰•çŠ¶æ³': getPaymentStatusText(dorm.paymentStatus),
                        'æ¸…æƒçŠ¶æ³': getCleaningStatusText(dorm.cleaningStatus)
                    }));
                    filename = `å…¨åœ°åŸŸå¯®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹_${new Date().toISOString().split('T')[0]}.xlsx`;
                } else {
                    data = allLogs.map(log => ({
                        'æ—¥æ™‚': new Date(log.timestamp).toLocaleString('ja-JP'),
                        'åœ°åŸŸ': regions[log.region].name,
                        'å¯®ç•ªå·': `å¯®${log.dormNumber}`,
                        'æ“ä½œ': getActionText(log.action),
                        'æ‹…å½“è€…': log.staff,
                        'å‚™è€ƒ': log.notes || ''
                    }));
                    filename = `å…¨åœ°åŸŸæ´»å‹•ãƒ­ã‚°_${new Date().toISOString().split('T')[0]}.xlsx`;
                }

                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'ãƒ‡ãƒ¼ã‚¿');
                XLSX.writeFile(wb, filename);
                
                hideLoading();
                showNotification('Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ', 'success');
            }, 1000);
        }

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function getStatusText(status) {
            const statusMap = {
                vacant: 'ç©ºå®¤',
                occupied: 'å…¥å®¤ä¸­',
                cleaning: 'æ¸…æƒä¸­',
                maintenance: 'ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹'
            };
            return statusMap[status] || status;
        }

        function getActionText(action) {
            const actionMap = {
                checkin: 'å…¥å®¤',
                checkout: 'é€€å®¤',
                cleaning: 'æ¸…æƒé–‹å§‹',
                cleaned: 'æ¸…æƒå®Œäº†',
                update: 'ãƒ‡ãƒ¼ã‚¿æ›´æ–°',
                bulk_update: 'ä¸€æ‹¬æ›´æ–°'
            };
            return actionMap[action] || action;
        }

        function getPaymentStatusText(status) {
            const statusMap = {
                paid: 'æ”¯æ‰•æ¸ˆ',
                pending: 'æœªæ‰•ã„',
                overdue: 'é…å»¶'
            };
            return statusMap[status] || status;
        }

        function getCleaningStatusText(status) {
            const statusMap = {
                clean: 'æ¸…æ½”',
                dirty: 'è¦æ¸…æƒ',
                deep: 'å¤§æƒé™¤å¿…è¦'
            };
            return statusMap[status] || status;
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const iconMap = {
                success: 'fas fa-check-circle text-green-600',
                error: 'fas fa-exclamation-circle text-red-600',
                warning: 'fas fa-exclamation-triangle text-yellow-600',
                info: 'fas fa-info-circle text-blue-600'
            };
            
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="${iconMap[type]} mr-3 text-lg"></i>
                        <span class="font-semibold">${message}</span>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-gray-400 hover:text-gray-600 text-lg">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        function saveAllChanges() {
            showLoading();
            setTimeout(() => {
                Object.keys(regions).forEach(regionId => {
                    saveRegionData(regionId);
                });
                hideLoading();
                showNotification('ã™ã¹ã¦ã®å¤‰æ›´ã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'success');
            }, 500);
        }

        function quickExport() {
            exportToExcel('current');
        }

        function filterSpreadsheet() {
            const regionFilter = document.getElementById('regionFilter').value;
            currentRegionFilter = regionFilter;
            renderSpreadsheet();
        }

        function filterLogs() {
            renderLogs();
        }

        // ä¸€æ‹¬ç·¨é›†é–¢é€£
        function bulkEditMode() {
            document.getElementById('bulkEditModal').classList.remove('hidden');
        }

        function closeBulkEditModal() {
            document.getElementById('bulkEditModal').classList.add('hidden');
            document.getElementById('bulkRegion').value = '';
            document.getElementById('bulkStatus').value = '';
            document.getElementById('bulkStaff').value = '';
            document.getElementById('bulkNotes').value = '';
            document.getElementById('bulkSelectDorms').innerHTML = '';
        }

        document.getElementById('bulkRegion').addEventListener('change', function() {
            const regionId = this.value;
            const dormsContainer = document.getElementById('bulkSelectDorms');
            
            if (!regionId) {
                dormsContainer.innerHTML = '';
                return;
            }
            
            const regionDorms = Object.values(allDormitories).filter(dorm => dorm.region === regionId);
            
            dormsContainer.innerHTML = regionDorms.map(dorm => `
                <label class="flex items-center space-x-2 p-2 hover:bg-gray-50 rounded cursor-pointer">
                    <input type="checkbox" value="${regionId}_${dorm.number}" class="bulk-dorm-checkbox">
                    <span class="text-sm font-medium">å¯®${dorm.number}</span>
                </label>
            `).join('');
        });

        function executeBulkEdit() {
            const selectedDorms = Array.from(document.querySelectorAll('.bulk-dorm-checkbox:checked')).map(cb => cb.value);
            const status = document.getElementById('bulkStatus').value;
            const staff = document.getElementById('bulkStaff').value;
            const notes = document.getElementById('bulkNotes').value;
            
            if (selectedDorms.length === 0) {
                showNotification('å¯®ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            if (!status && !staff && !notes) {
                showNotification('å¤‰æ›´ã™ã‚‹é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            showLoading();
            
            setTimeout(() => {
                selectedDorms.forEach(dormKey => {
                    const dorm = allDormitories[dormKey];
                    const [region, dormNumber] = dormKey.split('_');
                    
                    if (status) dorm.status = status;
                    if (staff) dorm.staff = staff;
                    if (notes) dorm.notes = notes;
                    dorm.lastUpdated = new Date().toISOString();
                    
                    allLogs.unshift({
                        id: allLogs.length + 1,
                        dormNumber: parseInt(dormNumber),
                        action: 'bulk_update',
                        staff: 'ç®¡ç†è€…',
                        timestamp: new Date().toISOString(),
                        notes: `ä¸€æ‹¬ç·¨é›†: ${notes}`,
                        region: region
                    });
                    
                    saveRegionData(region);
                });
                
                hideLoading();
                closeBulkEditModal();
                renderSpreadsheet();
                updateOverview();
                showNotification(`${selectedDorms.length}ä»¶ã®å¯®ã‚’ä¸€æ‹¬æ›´æ–°ã—ã¾ã—ãŸ`, 'success');
            }, 1000);
        }

        function deleteDormData(dormKey) {
            if (!confirm('æœ¬å½“ã«ã“ã®å¯®ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                return;
            }
            
            const [region, dormNumber] = dormKey.split('_');
            
            allLogs.unshift({
                id: allLogs.length + 1,
                dormNumber: parseInt(dormNumber),
                action: 'delete',
                staff: 'ç®¡ç†è€…',
                timestamp: new Date().toISOString(),
                notes: 'ãƒ‡ãƒ¼ã‚¿å‰Šé™¤',
                region: region
            });
            
            delete allDormitories[dormKey];
            saveRegionData(region);
            renderSpreadsheet();
            updateOverview();
            showNotification('ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
        }

        function validateAllData() {
            showLoading();
            
            setTimeout(() => {
                const errors = [];
                const warnings = [];
                
                Object.values(allDormitories).forEach(dorm => {
                    const dormId = `${regions[dorm.region].name} å¯®${dorm.number}`;
                    
                    if (dorm.status === 'occupied' && !dorm.checkinDate) {
                        errors.push(`${dormId}: å…¥å®¤ä¸­ã§ã™ãŒå…¥å®¤æ—¥ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“`);
                    }
                    
                    if (dorm.status === 'occupied' && dorm.paymentStatus === 'overdue') {
                        warnings.push(`${dormId}: å…¥å®¤ä¸­ã§ã™ãŒæ”¯æ‰•ã„ãŒé…å»¶ã—ã¦ã„ã¾ã™`);
                    }
                    
                    if (dorm.expectedCheckout && new Date(dorm.expectedCheckout) < new Date() && dorm.status === 'occupied') {
                        errors.push(`${dormId}: é€€å®¤äºˆå®šæ—¥ãŒéãã¦ã„ã¾ã™`);
                    }
                    
                    if (dorm.status === 'cleaning' && dorm.cleaningStatus === 'clean') {
                        warnings.push(`${dormId}: æ¸…æƒä¸­ã§ã™ãŒæ¸…æƒçŠ¶æ³ãŒã€Œæ¸…æ½”ã€ã«ãªã£ã¦ã„ã¾ã™`);
                    }
                    
                    if (!dorm.price || dorm.price <= 0) {
                        errors.push(`${dormId}: æ–™é‡‘ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“`);
                    }
                });
                
                hideLoading();
                
                let message = '';
                if (errors.length === 0 && warnings.length === 0) {
                    message = 'âœ… ãƒ‡ãƒ¼ã‚¿ã«å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“';
                    showNotification(message, 'success');
                } else {
                    message = `âš ï¸ ã‚¨ãƒ©ãƒ¼: ${errors.length}ä»¶, è­¦å‘Š: ${warnings.length}ä»¶ã‚’æ¤œå‡ºã—ã¾ã—ãŸã€‚`;
                    showNotification(message, 'warning');
                    
                    if (errors.length > 0) {
                        console.group('ğŸš¨ ã‚¨ãƒ©ãƒ¼');
                        errors.forEach(error => console.error(error));
                        console.groupEnd();
                    }
                    
                    if (warnings.length > 0) {
                        console.group('âš ï¸ è­¦å‘Š');
                        warnings.forEach(warning => console.warn(warning));
                        console.groupEnd();
                    }
                    
                    console.log('è©³ç´°ã¯ä¸Šè¨˜ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ã”ç¢ºèªãã ã•ã„ã€‚');
                }
            }, 1500);
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            updateOverview();
            showSection('overview');
            console.log('ç®¡ç†è€…ã‚·ã‚¹ãƒ†ãƒ ãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
        });
    </script>
</body>
</html>